<?php
/**
 * @author      Sven Weingartner <sven.weingartner@communitales.com>
 * @copyright   Copyright (c) 2016 Communitales GmbH (http://www.communitales.com/)
 */

require_once(dirname(__FILE__).'/Communitales/MalwareScanner.php');
require_once(dirname(__FILE__).'/Communitales/MalwareAnalyzer.php');
require_once(dirname(__FILE__).'/Communitales/Whitelister.php');
require_once(dirname(__FILE__).'/Config/Patterns.php');

// Does not work on linux, because it lowercases all classes
//spl_autoload_register();

if (!isset($argv[1])) {

    echo "Usage: php scan-malware.php [DIRECTORY]\n";
    echo '';

} else {
    $directory = $argv[1];

    $params = isset($argv[2]) ? $argv[2] : null;

    $scanner = new \Communitales\MalwareScanner();

    if ($params == '--whitelist') {
        $scanner->setCreateWhitelist(true);
    }

    $scanner->scanDirectory($directory);

    if ($params == '--whitelist') {
        $whitelistFilename = isset($argv[3]) ? $argv[3] : basename($directory);
        $scanner->writeWhitelistToFile($whitelistFilename);
    }

    echo "\n\nDONE.\n";
}
